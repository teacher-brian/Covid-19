covid_US_cases_tidy %>% filter(Province_State=="Arizona") %>% group_by(Admin2) %>%
select(Admin2) %>% with(unique(Admin2)) %>% left_join(Admin2$Admin2,arizona.pop$county,by="Admin2")
covid_US_cases_tidy %>% filter(Province_State=="Arizona") %>% group_by(Admin2) %>%
select(Admin2,Date,count)
covid_US_cases_tidy %>% filter(Province_State=="Arizona") %>% group_by(Admin2) %>%
select(Admin2,Date,count) %>% left_join(Admin2,arizona.pop$county,by="Admin2")
covid_US_cases_tidy %>% filter(Province_State=="Arizona") %>% group_by(Admin2) %>%
select(Admin2,Date,count) %>% left_join(Admin2,arizona.pop$county,by="county")
covid_US_cases_tidy %>% filter(Province_State=="Arizona") %>% group_by(Admin2) %>%
select(Admin2,Date,count)->zona
zona
zona %>% left_join("Admin2",arizona.pop$county,by="county")
zona %>% left_join(zona$Admin2,arizona.pop$county,by="county")
zona %>% left_join(zona$Admin2,arizona.pop$county,by="Admin2")
zona %>% left_join(x=zona$Admin2,y=arizona.pop$county,by="Admin2")
zona %>% left_join(x=zona$Admin2,y=arizona.pop$county,by="county")
covid_cases_us %>% select(-c(X1.22.20:recent_date))
UID_info
UID_dates
class(zona)
as.data.frame(zona)
str(zona)
str(as.data.frame(zona))
covid_US_cases_tidy %>% filter(Province_State=="Arizona") %>% group_by(Admin2) %>%
select(Admin2,Date,count)->data.frame(zona)
covid_US_cases_tidy %>% filter(Province_State=="Arizona") %>% group_by(Admin2) %>%
select(Admin2,Date,count)->as.data.frame(zona)
covid_US_cases_tidy %>% filter(Province_State=="Arizona") %>% group_by(Admin2) %>%
select(Admin2,Date,count)->zona
zona <- as.data.frame(zona)
zona %>% left_join(x=zona$Admin2,y=arizona.pop$county,by="county")
str(zona)
str(arizona.pop)
zona %>% left_join(x=zona$Admin2,y=arizona.pop$county,by="county")
str(UID_dates)
str(UID_info)
zona %>% left_join(x=as.character(zona$Admin2),y=as.character(arizona.pop$county),by="county")
zona %>% left_join(x=zona,y=arizona.pop,by="arizona.pop$county=zona$Admin2")
arizona.pop$county
zona$Admin2
zona %>% left_join(x=zona,y=arizona.pop,by=c("arizona.pop$county"="zona$Admin2"))
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county"))
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>% summarise(cases.capita=count/pop)
zona
as.character(zona$Date )
ymd(as.character(zona$Date ))
ymd(as.character(zona$Date ))
zona$Date<- ymd(as.character(zona$Date ))
zona
str(zona)
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>% summarise(cases.capita=count/pop) %>% filter(Date>"2020-04-01")
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>% summarise(cases.capita=count/pop) %>% filter(Date>"2020-04-01") %>%
ggplot(aes(x=Date,y=cases.capita))+ geom_line()+
facet_wrap(~Admin2)
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>% summarise(cases.capita=count/pop) %>% filter(Date>"2020-04-01") %>%
ggplot(aes(x=Date,y=cases.capita))+ geom_line()+
facet_wrap(~Admin2,scales = 'free')
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag)
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>%
summarise(new_cases.capita=new_cases/pop)
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>%
summarise(new_cases.capita=new_cases/pop) %>% filter(Date>"2020-04-01")
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>%
summarise(new_cases.capita=new_cases/pop) %>% filter(Date>"2020-05-01")
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>%
summarise(new.cases.capita=new_cases/pop) %>% filter(Date>"2020-05-01") %>%
ggplot(aes(x=Date,y=new.cases.capita))+ geom_line()+
facet_wrap(~Admin2)
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag)
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% with(tail())
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% with(tail(.))
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% with(tail())
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date)
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>%
mutate(count_lag=lag(count,1))
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>% filter(count>0)
mutate(count_lag=lag(count,1))
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>% filter(count>0) %>%
mutate(count_lag=lag(count,1))
covid_US_cases_tidy %>% filter(Date>today()-21,Province_State=='Washington') %>%
#filter(Admin2 == "King" |Admin2 %in% new.cases) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>% select(-c(iso2:FIPS,Country_Region)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag)
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>% arrange(desc(Date))
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>% arrange(desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag)
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>% arrange(desc(Date,Admin2))
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>% arrange(desc(Admin2,Date))
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>% arrange(desc(Admin2,Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag)
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>% arrange(desc(Admin2,Date)) %>%
mutate(count_lag=lag(count,1))
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2,Date) %>% arrange(desc(Admin2,-Date)) %>%
mutate(count_lag=lag(count,1))
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county")) %>%
group_by(Admin2) %>% arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1))
zona %>% left_join(x=zona,y=arizona.pop,by=c("Admin2"="county"))->zona
zona
zona %>% filter(Date>today()-21)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases))
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
ggplot(aes(x=Date,y=new_cases))+ geom_line()+
facet_wrap(~Admin2)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
summarise(new_cases/pop)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=nc.cap))+ geom_line()+
facet_wrap(~Admin2)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=nc.cap))+ geom_line()+
facet_wrap(~Admin2,scales='free')
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases))
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases))
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date)
)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date))
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(-desc(Date))
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date))
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Admin2,Date)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Admin2,Date) %>% arrange(-desc(Date))
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Admin2,Date) %>% arrange(desc(Admin2),desc(Date))
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Admin2,Date) %>% arrange(-desc(Admin2),desc(Date))
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Admin2,Date) %>% arrange(-desc(Admin2),desc(Date)) %>% mutate(days.7=1:7)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Admin2,Date) %>% arrange(-desc(Admin2),desc(Date)) %>% mutate(days.7=c(1:7))
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Admin2,Date) %>% arrange(-desc(Admin2),desc(Date)) %>% mutate(days.7=rep(1:7))
rep(1:7)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Admin2,Date) %>% arrange(-desc(Admin2),desc(Date)) %>% mutate(days.7=rep(1:7))
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Admin2,Date) %>% arrange(desc(Admin2),desc(Date))
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Admin2,Date) %>% arrange(desc(Admin2),-desc(Date))
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=nc.cap))+ geom_line()+
facet_wrap(~Admin2,scales='free')
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=nc.cap))+ geom_line()+
geom_smooth(method='lm')+
facet_wrap(~Admin2,scales='free')
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=nc.cap))+ geom_line()+
geom_smooth()+
facet_wrap(~Admin2,scales='free')
zona %>% filter(Date>today()-61) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=nc.cap))+ geom_line()+
geom_smooth()+
facet_wrap(~Admin2,scales='free')
zona %>% filter(Date>today()-61) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=nc.cap))+ geom_line()+
geom_smooth()+
facet_wrap(~Admin2,scales='fixed')
zona %>% filter(Date>today()-61) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=nc.cap))+ geom_line()+
geom_smooth()+
facet_wrap(~Admin2,scales='fixed')
zona %>% filter(Date>today()-61) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=new_cases))+ geom_line()+
geom_smooth()+
facet_wrap(~Admin2,scales='fixed')
zona %>% filter(Date>today()-61) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=new_cases))+ geom_line()+
geom_smooth()+
facet_wrap(~Admin2,scales='free')
zona %>% filter(Date>today()-61) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=new_cases))+ geom_line()+
geom_smooth()+
facet_grid(~Admin2,scales='free')
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=new_cases))+ geom_line()+
geom_smooth()+
facet_grid(~Admin2,scales='free')
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=new_cases))+ geom_line()+
geom_smooth()+
facet_wrap(~Admin2,scales='free')+
ggtext(main="New cases in Arizona")
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=new_cases))+ geom_line()+
geom_smooth()+
facet_wrap(~Admin2,scales='free')+
ggtitle(main="New cases in Arizona")
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=new_cases))+ geom_line()+
geom_smooth()+
facet_wrap(~Admin2,scales='free')+
ggtitle("New cases in Arizona")
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=nc.cap))+ geom_line()+
geom_smooth()+
facet_wrap(~Admin2,scales='free')+
ggtitle("New cases in Arizona")
library(scales)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(nc.cap=new_cases/pop) %>%
ggplot(aes(x=Date,y=nc.cap))+ geom_line()+
geom_smooth()+
facet_wrap(~Admin2,scales='free')+
ggtitle("New cases Proportional to county population in Arizona")
covid_US_cases_tidy %>% filter(Date>today()-21,Province_State=='Washington') %>%
#filter(Admin2 == "King" |Admin2 %in% new.cases) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>% select(-c(iso2:FIPS,Country_Region)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(sort.Admin2=factor(Admin2))-> wa.new.cases#
wa.new.cases[,c(3,12)] <- lapply(wa.new.cases[,c(3,12)],function(x) factor(x))
lapply(wa.new.cases[,c('Admin2','sort.Admin2')], levels)
wa.new.cases[,12] <- factor(wa.new.cases$Admin2,levels = wa.new.cases$Admin2[1:41], ordered = T)
wa.new.cases %>%
ggplot(aes(Date,new_cases))+
geom_point(shape=18)+geom_line(alpha=.2)+geom_smooth(se=F)+
facet_wrap(~sort.Admin2,scales = 'fixed')
covid_cases_us <- read.csv(here::here("data","covid_US_cases_raw.csv"),stringsAsFactors = F)
# tidy up the data for graphing
recent_date <- colnames(covid_cases_us)[length(covid_cases_us)]
head(covid_cases_us)
str(covid_cases_us)
UID_dates<- covid_cases_us %>% select(UID,X1.22.20:recent_date) %>% gather(key = Date, value= count,-UID)
UID_info<- covid_cases_us %>% select(-c(X1.22.20:recent_date))
covid_US_cases_tidy<- left_join(UID_info,UID_dates,by="UID")
covid_US_cases_tidy<-covid_US_cases_tidy %>% mutate(Date=gsub("X","",Date))
str(covid_US_cases_tidy)
cols<- names(covid_US_cases_tidy[c(1:8,11)])
#Use lapply() to coerce and replace the chosen columns:
covid_US_cases_tidy[cols] <- lapply(covid_US_cases_tidy[cols], factor)  ## as.factor() could also be used
covid_US_cases_tidy$Date<- mdy(covid_US_cases_tidy$Date)
str(covid_US_cases_tidy)
#write.csv(covid_US_cases_tidy,file='./data/covid_US_cases_tidy.csv')
#covid_US_cases_tidy<- read.csv(file='./data/covid_US_cases_tidy.csv')
# list of counties in Washington
covid_US_cases_tidy %>% filter(Province_State=="Washington") %>% group_by(Admin2) %>%
summarise(m=max(count)) %>% arrange(desc(m))
# total cumulative cases in Washington state, King and Spkane county
covid_US_cases_tidy %>% filter(Province_State=="Washington"#,
#Admin2=="King"|
# Admin2=="Spokane"|
#Admin2=="Snohomish",count>01
) %>%
group_by(Admin2) %>%
arrange(desc(Date)) %>% select(-c(iso2:FIPS,Country_Region)) %>% group_by(Date)%>%
ggplot(aes(Date,count,color=Admin2))+geom_point(shape=18)+
geom_line(stat='smooth',se=F,alpha=.6)+
facet_wrap(~Admin2,scales='free')
new.cases <- c("Adams",'Benton','Grant', 'Clark', 'Franklin','Skagit','Spokane','Thurston','Walla Walla','Yakima',"King")
covid_US_cases_tidy %>% filter(Date>today()-21,Province_State=='Washington') %>%
#filter(Admin2 == "King" |Admin2 %in% new.cases) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>% select(-c(iso2:FIPS,Country_Region)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>%
mutate(sort.Admin2=factor(Admin2))-> wa.new.cases#
#wa.new.cases %>%
wa.new.cases[,c(3,12)] <- lapply(wa.new.cases[,c(3,12)],function(x) factor(x))
lapply(wa.new.cases[,c('Admin2','sort.Admin2')], levels)
wa.new.cases[,12] <- factor(wa.new.cases$Admin2,levels = wa.new.cases$Admin2[1:41], ordered = T)
wa.new.cases %>%
ggplot(aes(Date,new_cases))+
geom_point(shape=18)+geom_line(alpha=.2)+geom_smooth(se=F)+
facet_wrap(~sort.Admin2,scales = 'fixed')
wa.new.cases %>%
ggplot(aes(Date,new_cases))+
geom_point(shape=18)+geom_line(alpha=.2)+geom_smooth(se=F)+
facet_wrap(~sort.Admin2,scales = 'free')
wa.new.cases
wa.new.cases
wa.new.cases %>% select(Admin2,Date,new.cases)
wa.new.cases %>% select(Admin2,Date,new_cases)
wa.new.cases %>% select(Admin2,Date,new_cases) %>% print(.,n=35)
wa.new.cases %>% select(Admin2,Date,new_cases) %>% print(.,n=40)
wa.new.cases %>% select(Admin2,Date,new_cases)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases))
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>% select(Admin2,Date,new.cases)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>% select(Admin2,Date,new_cases)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases))
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>% select(Admin2,Date,new_cases)
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>% select(Admin2,Date,new_cases) %>% filter(Admin2=='Pinal')
zona %>% filter(Date>today()-21) %>%
group_by(Admin2) %>%
arrange(-desc(Date)) %>%
mutate(count_lag=lag(count,1),new_cases=count-count_lag) %>% group_by(Date) %>%
arrange(desc(Date),desc(new_cases)) %>% select(Admin2,Date,new_cases) %>% filter(Admin2=='Pinal')->pinal
wa.new.cases %>% filter(Admin2=="Grant") %>% selectd(Admin2,Date,new_cases)
wa.new.cases %>% filter(Admin2=="Grant") %>% select(Admin2,Date,new_cases)
wa.new.cases %>% filter(Admin2=="Grant") %>% select(Admin2,Date,new_cases)->grant
rbind(grant,pinal)
rbind(pinal,grant)
dad<- rbind(pinal,grant)
dad
dad %>%
ggplot(aes(x=Date,y=new_cases)) +geom_line()
dad %>%
ggplot(aes(x=Date,y=new_cases)) +geom_line()+
facet_grid(~Admin2)
dad %>%
ggplot(aes(x=Date,y=new_cases,color=Admin2)) +geom_line()+
facet_grid(~Admin2)
dad %>%
ggplot(aes(x=Date,y=new_cases)) +geom_line()+
facet_wrap(~Admin2)+geom_smooth()
